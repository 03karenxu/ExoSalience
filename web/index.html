<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ExoSalience Classifier</title>
  <style>
    :root {
      color-scheme: light dark;
      --accent: #2d6cdf;
      --accent-soft: rgba(45, 108, 223, 0.12);
      --border: rgba(0, 0, 0, 0.1);
      --bg: #f7f9fc;
      --card: #ffffff;
      --text: #131c2b;
      font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 3rem 1.5rem;
    }

    main {
      width: min(880px, 100%);
      display: grid;
      gap: 1.5rem;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    h1 {
      margin: 0;
      font-size: clamp(1.75rem, 2.4vw, 2.5rem);
      letter-spacing: -0.02em;
    }

    p.lead {
      margin: 0;
      color: #51627b;
      font-size: 1.02rem;
      line-height: 1.5;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 1.75rem;
      box-shadow: 0 24px 48px -32px rgba(13, 35, 67, 0.2);
    }

    form {
      display: grid;
      gap: 1.25rem;
    }

    .field {
      display: grid;
      gap: 0.5rem;
    }

    label {
      font-weight: 600;
      font-size: 0.95rem;
    }

    input[type="file"] {
      padding: 0.75rem;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: #f5f7fb;
      color: inherit;
    }

    input[type="file"]:focus-visible {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    .hint {
      font-size: 0.85rem;
      color: #6b7a94;
    }

    button[type="submit"] {
      justify-self: start;
      background: var(--accent);
      color: white;
      font-weight: 600;
      border: none;
      border-radius: 999px;
      padding: 0.75rem 1.65rem;
      cursor: pointer;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      box-shadow: 0 12px 24px -16px rgba(45, 108, 223, 0.6);
    }

    button[type="submit"]:hover {
      transform: translateY(-1px);
    }

    button[type="submit"]:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    #status {
      min-height: 1rem;
      font-size: 0.9rem;
      color: #3b4b63;
    }

    #file-summary {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      background: var(--accent-soft);
      font-size: 0.92rem;
      display: none;
    }

    #results {
      display: none;
      border-radius: 18px;
      padding: 1.5rem;
      border: 1px dashed rgba(45, 108, 223, 0.4);
      background: rgba(45, 108, 223, 0.05);
      font-size: 0.95rem;
    }

    #results strong {
      display: block;
      margin-bottom: 0.5rem;
    }

    .result-list {
      margin: 0;
      padding-left: 1.1rem;
    }

    footer {
      font-size: 0.8rem;
      color: #6b7a94;
      text-align: center;
    }
  </style>
</head>
<body>
  <main>
    <header>
      <h1>ExoSalience Classifier</h1>
      <p class="lead">
        Upload a target cohort CSV alongside a zipped light-curve bundle to preview a mock
        exoplanet classification request. This UI will connect to the Astronet-based
        inference service once the backend is ready.
      </p>
    </header>

    <section class="card" aria-labelledby="upload-title">
      <h2 id="upload-title" style="margin-top:0">Upload Observation Set</h2>
      <form id="upload-form" autocomplete="off">
        <div class="field">
          <label for="csv-input">Catalog CSV</label>
          <input
            id="csv-input"
            name="csv"
            type="file"
            accept=".csv"
            required
          />
          <span class="hint">Tabular target metadata, indexed by object id.</span>
        </div>

        <div class="field">
          <label for="zip-input">Light Curve Bundle (ZIP)</label>
          <input
            id="zip-input"
            name="fits_zip"
            type="file"
            accept=".zip"
            required
          />
          <span class="hint">Compressed FITS set aligned to the catalog ids.</span>
        </div>

        <div id="file-summary"></div>

        <button type="submit">Run Mock Classification</button>
        <div id="status" role="status" aria-live="polite"></div>
      </form>
    </section>

    <section id="results" aria-live="polite"></section>

    <footer>
      Mock responses only. Replace <code>mockSend</code> with an API call once the
      FastAPI endpoint is ready.
    </footer>
  </main>

  <script>
    const form = document.getElementById("upload-form");
    const csvInput = document.getElementById("csv-input");
    const zipInput = document.getElementById("zip-input");
    const statusEl = document.getElementById("status");
    const summaryEl = document.getElementById("file-summary");
    const resultsEl = document.getElementById("results");

    function summarizeFiles() {
      const csvFile = csvInput.files[0];
      const zipFile = zipInput.files[0];

      if (!csvFile && !zipFile) {
        summaryEl.style.display = "none";
        summaryEl.textContent = "";
        return;
      }

      const rows = [];
      if (csvFile) {
        rows.push(`CSV: ${csvFile.name} (${Math.round(csvFile.size / 1024)} KB)`);
      }
      if (zipFile) {
        rows.push(`ZIP: ${zipFile.name} (${Math.round(zipFile.size / 1024)} KB)`);
      }

      summaryEl.innerHTML = rows.join("<br />");
      summaryEl.style.display = "block";
    }

    csvInput.addEventListener("change", summarizeFiles);
    zipInput.addEventListener("change", summarizeFiles);

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      if (!csvInput.files.length || !zipInput.files.length) {
        statusEl.textContent = "Both files are required.";
        return;
      }

      const formData = new FormData(form);
      statusEl.textContent = "Sending mock request…";
      resultsEl.style.display = "none";
      resultsEl.innerHTML = "";
      form.querySelector("button[type='submit']").disabled = true;

      try {
        const response = await mockSend(formData);
        statusEl.textContent = "Mock response received.";
        renderResults(response);
      } catch (error) {
        console.error(error);
        statusEl.textContent = "Mock request failed. Check the console for details.";
      } finally {
        form.querySelector("button[type='submit']").disabled = false;
      }
    });

    async function mockSend(formData) {
      await new Promise((resolve) => setTimeout(resolve, 600));

      const csvFile = formData.get("csv");
      const zipFile = formData.get("fits_zip");
      return {
        status: "ok",
        meta: {
          ingestion: new Date().toISOString(),
          csvName: csvFile ? csvFile.name : "",
          bundleName: zipFile ? zipFile.name : "",
        },
        predictions: [
          { id: "KIC 8264586", probability: 0.87, label: "Likely exoplanet" },
          { id: "KIC 11853905", probability: 0.41, label: "Needs review" },
        ],
        message: "Replace mockSend with a real fetch call to the FastAPI upload endpoint.",
      };
    }

    function renderResults(payload) {
      if (!payload || payload.status !== "ok") {
        resultsEl.textContent = "Unexpected mock payload.";
        resultsEl.style.display = "block";
        return;
      }

      const lines = [];
      const bundleDescriptor = payload.meta.bundleName ? ` + ${payload.meta.bundleName}` : "";
      lines.push(`<strong>Mock summary for ${payload.meta.csvName || "uploaded data"}${bundleDescriptor}</strong>`);
      lines.push(`<div>${payload.message}</div>`);

      if (Array.isArray(payload.predictions) && payload.predictions.length) {
        const items = payload.predictions
          .map((item) => {
            const confidence = Math.round(item.probability * 100);
            return `<li><span>${item.id}</span> – <strong>${confidence}%</strong> (${item.label})`;
          })
          .join("");
        lines.push(`<ol class="result-list">${items}</ol>`);
      }

      resultsEl.innerHTML = lines.join("");
      resultsEl.style.display = "block";
    }
  </script>
</body>
</html>
